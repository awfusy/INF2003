<!--
=========================================================
* * Black Dashboard - v1.0.1
=========================================================

* Product Page: https://www.creative-tim.com/product/black-dashboard
* Copyright 2019 Creative Tim (https://www.creative-tim.com)


* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
{% include 'includes/head.html' %}

<body class="">
  <div class="wrapper">
    <div class="sidebar">
      <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red"
    -->
      <div class="sidebar-wrapper">
        <div class="logo">
          <a href="javascript:void(0)" class="simple-text logo-mini">
            AD
          </a>
          <a href="javascript:void(0)" class="simple-text logo-normal">
            INF2003
          </a>
        </div>
        <ul class="nav">
          <li class="active ">
            <a href="./index.html">
              <i class="tim-icons icon-chart-pie-36"></i>
              <p>Dashboard</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      {% include 'includes/nav.html' %}
      <div class="content bg-dark">
        <div class="row">
          <div class="col-12">
            <div class="card card-chart">
              <div class="card-header ">
                <div class="row">
                  <div class="col-sm-6 text-left">
                    <h5 class="card-category">What we want to find</h5>
                    <h2 class="dynamic-card-title">Revenue generated by category</h2>
                  </div>
                  <div class="col-sm-6 text-left">
                    <div class="dropdown-new">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Choose analysis
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="options">
                        <a class="dropdown-item" value="Query 1">Revenue Generated By category</a>
                        <a class="dropdown-item" value="Query 2">Product category with most in 5* review</a>
                        <a class="dropdown-item" value="Query 3">Most popular product category by geolocation</a>
                        <a class="dropdown-item" value="Query 4">Frequently Bought Category</a>
                        <a class="dropdown-item" value="Query 5">Most revenue by location</a>
                        <a class="dropdown-item" value="Query 6">Most commonly used payment methods</a>
                        <a class="dropdown-item" value="Query 7">Average completion of processing time/ shipping
                          time</a>
                        <a class="dropdown-item" value="Query 8">Average delivery time and freight fee</a>
                        <a class="dropdown-item" value="Query 9">Average customer reviews score on product category</a>
                        <a class="dropdown-item" value="Query 10">Categories with the most sellers</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="card-body col-12">
                  <div class="chart-area d-flex justify-content-center">
                    <!-- <canvas id="chartBig1"> -->
                    <img id="dynamicChartImage" src="data:image/png;base64,{{ q1_chart_image }}" alt="Bar Chart">
                    <!-- </canvas> -->
                  </div>
                </div>
              </div>
            </div>
            <div class="card card-chart">
              <div class="row">
                <h2 class="card-title col-12 d-flex justify-content-center">Query comparison</h2>
                <div class="card-body-sql col-6 text-center">
                  <p>SQL:<br /> <span class="sql-content">
                      SELECT
                      p.product_category_name,
                      COUNT(DISTINCT oi.order_id) AS Num_orders,
                      SUM(oi.price) AS Revenue
                      FROM
                      olist_order_items_dataset oi
                      JOIN
                      olist_products_dataset p ON oi.product_id = p.product_id
                      JOIN
                      olist_orders_dataset o ON oi.order_id = o.order_id
                      WHERE
                      o.order_status <> 'canceled'
                        AND o.order_delivered_customer_date IS NOT NULL
                        GROUP BY
                        p.product_category_name
                        ORDER BY
                        Revenue DESC;
                    </span>
                    <br /><br />
                    Average Time taken to Execute (ms): <span class="sql-time">100</span><br />
                  </p>
                </div>
                <div class="card-body-nosql col-6 text-center">
                  <p>NoSQL:<br /><span class="nosql-content">
                      revenue_by_cat_pipeline = [
                      {"$lookup": {"from": "products","localField": "product_id","foreignField": "product_id","as":
                      "product"}},
                      {"$unwind": "$product"},
                      {"$lookup": {"from": "translated_category","localField": "product.product_category_name",
                      "foreignField": "product_category_name","as": "translated_category"}},
                      {"$unwind": "$translated_category"},
                      {"$lookup": {"from": "orders","localField": "order_id","foreignField": "order_id","as": "order"}},
                      {
                      "$unwind": "$order"},
                      {"$match": {"order.order_status": "delivered",}},
                      {"$group": {"_id": "$translated_category.product_category_name_english","Num_orders":
                      {"$addToSet": "$order.order_id"},
                      "Revenue": {"$sum": "$price"}}},
                      {"$project": {"_id": 0,"product_category_name": "$_id","Num_orders": {"$size":
                      "$Num_orders"},"Revenue": 1}},
                      {"$sort": {"Revenue": -1}}
                      ]
                      order_items_collection.aggregate(revenue_by_cat_pipeline)
                    </span>
                    <br /><br />
                    Average Time taken to Execute (ms):<span class="nosql-time"></span> <br />
                  </p>
                </div>
              </div>
            </div>
            <div class="card card-chart">
              <div class="row">
                <h2 class="card-title col-12 d-flex justify-content-center">Analysis Result</h2>
                <div class="card-body col-12 text-center">
                  <p class="final-analysis">
                    Final Analysis
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% include 'includes/footer.html' %}
  </div>
  </div>
  <!--   Core JS Files   -->
  <script src="{{url_for('static', filename='js/core/jquery.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/core/popper.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/core/bootstrap.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/plugins/perfect-scrollbar.jquery.min.js')}}"></script>
  <!--  Google Maps Plugin    -->
  <!-- Place this tag in your head or just before your close body tag. -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
  <!-- Chart JS -->
  <script src="{{url_for('static', filename='js/plugins/chartjs.min.js')}}"></script>
  <!--  Notifications Plugin    -->
  <script src="{{url_for('static', filename='js/plugins/bootstrap-notify.js')}}"></script>
  <!-- Control Center for Black Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="{{url_for('static', filename='js/black-dashboard.min.js')}}"></script>

  <script>
    $(document).ready(function () {
      $().ready(function () {
        $sidebar = $('.sidebar');
        $navbar = $('.navbar');
        $main_panel = $('.main-panel');

        $full_page = $('.full-page');

        $sidebar_responsive = $('body > .navbar-collapse');
        sidebar_mini_active = true;
        white_color = false;

        window_width = $(window).width();

        fixed_plugin_open = $('.sidebar .sidebar-wrapper .nav li.active a p').html();

        $('.fixed-plugin a').click(function (event) {
          if ($(this).hasClass('switch-trigger')) {
            if (event.stopPropagation) {
              event.stopPropagation();
            } else if (window.event) {
              window.event.cancelBubble = true;
            }
          }
        });

        $('.fixed-plugin .background-color span').click(function () {
          $(this).siblings().removeClass('active');
          $(this).addClass('active');

          var new_color = $(this).data('color');

          if ($sidebar.length != 0) {
            $sidebar.attr('data', new_color);
          }

          if ($main_panel.length != 0) {
            $main_panel.attr('data', new_color);
          }

          if ($full_page.length != 0) {
            $full_page.attr('filter-color', new_color);
          }

          if ($sidebar_responsive.length != 0) {
            $sidebar_responsive.attr('data', new_color);
          }
        });

        $('.switch-sidebar-mini input').on("switchChange.bootstrapSwitch", function () {
          var $btn = $(this);

          if (sidebar_mini_active == true) {
            $('body').removeClass('sidebar-mini');
            sidebar_mini_active = false;
            blackDashboard.showSidebarMessage('Sidebar mini deactivated...');
          } else {
            $('body').addClass('sidebar-mini');
            sidebar_mini_active = true;
            blackDashboard.showSidebarMessage('Sidebar mini activated...');
          }

          // we simulate the window Resize so the charts will get updated in realtime.
          var simulateWindowResize = setInterval(function () {
            window.dispatchEvent(new Event('resize'));
          }, 180);

          // we stop the simulation of Window Resize after the animations are completed
          setTimeout(function () {
            clearInterval(simulateWindowResize);
          }, 1000);
        });

        $('.switch-change-color input').on("switchChange.bootstrapSwitch", function () {
          var $btn = $(this);

          if (white_color == true) {

            $('body').addClass('change-background');
            setTimeout(function () {
              $('body').removeClass('change-background');
              $('body').removeClass('white-content');
            }, 900);
            white_color = false;
          } else {

            $('body').addClass('change-background');
            setTimeout(function () {
              $('body').removeClass('change-background');
              $('body').addClass('white-content');
            }, 900);

            white_color = true;
          }


        });

        $('.light-badge').click(function () {
          $('body').addClass('white-content');
        });

        $('.dark-badge').click(function () {
          $('body').removeClass('white-content');
        });
      });
    });
  </script>
  <script src="https://cdn.trackjs.com/agent/v3/latest/t.js"></script>
  <script>
    window.TrackJS &&
      TrackJS.install({
        token: "ee6fab19c5a04ac1a32a645abde4613a",
        application: "black-dashboard-free"
      });
  </script>
  <script>
    $(document).ready(function () {
      $('#options a').on('click', function () {

        var queryValue = $(this).attr('value');
        var newText;
        var newSql;
        var newSqlTime;
        var newNosql;
        var newNosqlTime;
        var finalAnalysis;
        switch (queryValue) {
          case 'Query 1':
            newText = 'Revenue Generated By category';
            newSql = 'SELECT\n' +
              '    p.product_category_name,\n' +
              '    COUNT(DISTINCT oi.order_id) AS Num_orders,\n' +
              '    SUM(oi.price) AS Revenue\n' +
              'FROM\n' +
              '    olist_order_items_dataset oi\n' +
              '    JOIN olist_products_dataset p ON oi.product_id = p.product_id\n' +
              '    JOIN olist_orders_dataset o ON oi.order_id = o.order_id\n' +
              'WHERE\n' +
              '    o.order_status <> \'canceled\' AND\n' +
              '    o.order_delivered_customer_date IS NOT NULL\n' +
              'GROUP BY\n' +
              '    p.product_category_name\n' +
              'ORDER BY\n' +
              '    Revenue DESC\n' +
              'LIMIT 10;';
            newSqlTime = '100';
            newNosql = JSON.stringify([{
                "$lookup": {
                  "from": "products",
                  "localField": "product_id",
                  "foreignField": "product_id",
                  "as": "product"
                }
              },
              {
                "$unwind": "$product"
              },
              {
                "$lookup": {
                  "from": "translated_category",
                  "localField": "product.product_category_name",
                  "foreignField": "product_category_name",
                  "as": "translated_category"
                }
              },
              {
                "$unwind": "$translated_category"
              },
              {
                "$lookup": {
                  "from": "orders",
                  "localField": "order_id",
                  "foreignField": "order_id",
                  "as": "order"
                }
              },
              {
                "$unwind": "$order"
              },
              {
                "$match": {
                  "order.order_status": "delivered",
                }
              },
              {
                "$group": {
                  "_id": "$translated_category.product_category_name_english",
                  "Num_orders": {
                    "$addToSet": "$order.order_id"
                  },
                  "Revenue": {
                    "$sum": "$price"
                  }
                }
              },
              {
                "$project": {
                  "_id": 0,
                  "product_category_name": "$_id",
                  "Num_orders": {
                    "$size": "$Num_orders"
                  },
                  "Revenue": 1
                }
              },
              {
                "$sort": {
                  "Revenue": -1
                }
              }
            ]);
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 =
              '{{ q1_chart_image }}'; // add this from app.py result to change image according to case
            break;
          case 'Query 2':
            newText = 'Product category with most in 5* review';
            newSql = 'SELECT\n' +
              '    P.product_category_name,\n' +
              '    COUNT(R.review_score) AS Num_5_star_reviews\n' +
              'FROM\n' +
              '    olist_order_reviews_dataset R\n' +
              '    JOIN olist_order_items_dataset I ON R.order_id = I.order_id\n' +
              '    JOIN olist_products_dataset P ON I.product_id = P.product_id\n' +
              'WHERE\n' +
              '    R.review_score = 5\n' +
              'GROUP BY\n' +
              '    P.product_category_name\n' +
              'ORDER BY\n' +
              '    Num_5_star_reviews DESC\n' +
              'LIMIT 10;';
            newSqlTime = '444';
            newNosql = JSON.stringify([{
                "$match": {
                  "review_score": 5
                }
              },
              {
                "$lookup": {
                  "from": "order_items",
                  "localField": "order_id",
                  "foreignField": "order_id",
                  "as": "order_items"
                }
              },
              {
                "$unwind": "$order_items"
              },
              {
                "$lookup": {
                  "from": "products",
                  "localField": "order_items.product_id",
                  "foreignField": "product_id",
                  "as": "product"
                }
              },
              {
                "$unwind": "$product"
              },
              {
                "$lookup": {
                  "from": "translated_category",
                  "localField": "product.product_category_name",
                  "foreignField": "product_category_name",
                  "as": "translated_category"
                }
              },
              {
                "$unwind": "$translated_category"
              },
              {
                "$group": {
                  "_id": "$translated_category.product_category_name_english",
                  "count": {
                    "$sum": 1
                  }
                }
              },
              {
                "$sort": {
                  "count": -1
                }
              },
              {
                "$limit": 10
              }
            ]);
            newNosqlTime = '111';
            finalAnalysis = 'asdasdasdasda';
            dynamicChartImageBase64 =
              '{{ q2_chart_image }}'; // add this from app.py result to change image according to case
            break;
          case 'Query 3':
            newText = 'Most popular product category by geolocation';
            newSql = 'WITH StateCategorySales AS (\n' +
              '    SELECT\n' +
              '        c.customer_state AS state,\n' +
              '        p.product_category_name AS category,\n' +
              '        COUNT(o.order_id) AS QuantitySold\n' +
              '    FROM\n' +
              '        olist_orders_dataset o\n' +
              '        JOIN olist_order_items_dataset oi ON o.order_id = oi.order_id\n' +
              '        JOIN olist_customers_dataset c ON o.customer_id = c.customer_id\n' +
              '        JOIN olist_products_dataset p ON oi.product_id = p.product_id\n' +
              '    WHERE\n' +
              '        o.order_status = \'delivered\'\n' +
              '    GROUP BY\n' +
              '        c.customer_state, p.product_category_name\n' +
              '),\n' +
              'MaxSales AS (\n' +
              '    SELECT\n' +
              '        state,\n' +
              '        MAX(QuantitySold) AS MaxQuantitySold\n' +
              '    FROM\n' +
              '        StateCategorySales\n' +
              '    GROUP BY\n' +
              '        state\n' +
              ')\n' +
              'SELECT\n' +
              '    scs.state AS state,\n' +
              '    scs.category AS HighestSoldCategory,\n' +
              '    scs.QuantitySold\n' +
              'FROM\n' +
              '    StateCategorySales scs\n' +
              'JOIN\n' +
              '    MaxSales ON scs.state = maxSales.state AND scs.QuantitySold = maxSales.MaxQuantitySold\n' +
              'ORDER BY\n' +
              '    scs.QuantitySold DESC, scs.state;';
            newSqlTime = '100';
            newNosql = JSON.stringify([{
              "$lookup": {
                "from": "orders",
                "localField": "order_id",
                "foreignField": "order_id",
                "as": "order"
              },
              "$unwind": "$order",
              "$lookup": {
                "from": "customers",
                "localField": "order.customer_id",
                "foreignField": "customer_id",
                "as": "customer"
              },
              "$unwind": "$customer",
              "$lookup": {
                "from": "products",
                "localField": "product_id",
                "foreignField": "product_id",
                "as": "product"
              },
              "$unwind": "$product",
              "$lookup": {
                "from": "translated_category",
                "localField": "product.product_category_name",
                "foreignField": "product_category_name",
                "as": "translated_category"
              },
              "$unwind": "$translated_category",
              "$match": {
                "order.order_status": "delivered"
              },
              "$group": {
                "_id": {
                  "customer_state": "$customer.customer_state",
                  "product_category_name": "$translated_category.product_category_name_english"
                },
                "QuantitySold": {
                  "$sum": 1
                }
              },
              "$sort": {
                "QuantitySold": -1
              },
              "$group": {
                "_id": "$_id.customer_state",
                "HighestSoldCategory": {
                  "$first": "$_id.product_category_name"
                },
                "QuantitySold": {
                  "$first": "$QuantitySold"
                }
              },
              "$sort": {
                "QuantitySold": -1
              }
            }]);
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 =
              '{{ q3_chart_image }}'; // add this from app.py result to change image according to case
            break;
          case 'Query 4':
            newText = 'Frequently Bought items';
            newSql = 'SELECT p.product_category_name, COUNT(oi.order_id) AS order_count\n' +
              'FROM olist_order_items_dataset oi\n' +
              'JOIN olist_products_dataset p ON oi.product_id = p.product_id\n' +
              'GROUP BY p.product_category_name\n' +
              'ORDER BY order_count DESC;';
            newSqlTime = '902.8';
            newNosql = JSON.stringify([{
                "$lookup": {
                  "from": "order_items",
                  "localField": "order_id",
                  "foreignField": "order_id",
                  "as": "order_order_items"
                }
              },
              {
                "$unwind": "$order_order_items"
              },
              {
                "$lookup": {
                  "from": "products",
                  "localField": "order_order_items.product_id",
                  "foreignField": "product_id",
                  "as": "order_item_products"
                }
              },
              {
                "$unwind": "$order_item_products"
              },
              {
                "$lookup": {
                  "from": "translated_category",
                  "localField": "order_item_products.product_category_name",
                  "foreignField": "product_category_name",
                  "as": "translated_category"
                }
              },
              {
                "$unwind": "$translated_category"
              },
              {
                "$group": {
                  "_id": "$translated_category.product_category_name_english",
                  "purchaseCount": {
                    "$sum": 1
                  }
                }
              },
              {
                "$sort": {
                  "purchaseCount": -1
                }
              }
            ]);

            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q4_chart_image }}';
            break;
          case 'Query 5':
            newText = 'Most revenue by location';
            newSql = 'SELECT\n' +
              '    c.customer_city,\n' +
              '    c.customer_state,\n' +
              '    ROUND(SUM(oi.price),2) AS TotalRevenue\n' +
              'FROM\n' +
              '    olist_orders_dataset o\n' +
              'JOIN\n' +
              '    olist_order_items_dataset oi ON o.order_id = oi.order_id\n' +
              'JOIN\n' +
              '    olist_customers_dataset c ON o.customer_id = c.customer_id\n' +
              'WHERE\n' +
              '    o.order_status = \'delivered\'\n' +
              '    AND o.order_delivered_customer_date IS NOT NULL\n' +
              'GROUP BY\n' +
              '    c.customer_city, c.customer_state\n' +
              'ORDER BY\n' +
              '    TotalRevenue DESC\n' +
              'LIMIT 10;';
            newSqlTime = '100';
            newNosql = JSON.stringify(
              [
  {"$lookup": {"from": "orders", "localField": "customer_id", "foreignField": "customer_id", "as": "orders"}},
  {"$unwind": "$orders"},
  {"$lookup": {"from": "order_items", "localField": "orders.order_id", "foreignField": "order_id", "as": "order_items"}},
  {"$unwind": "$order_items"},
  {
    "$match": {
      "orders.order_status": "delivered",
      "orders.order_delivered_customer_date": {"$ne": null}
    }
  },
  {
    "$group": {
      "_id": {
        "city": "$customer_city",
        "state": "$customer_state"
      },
      "total_revenue": {"$sum": "$order_items.price"}
    }
  },
  {"$sort": {"total_revenue": -1}}
]
            );
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q5_chart_image }}';
            break;
          case 'Query 6':
            newText = 'Most commonly used payment methods';
            newSql = 'SELECT payment_type, COUNT(order_id) AS payment_count\n' +
              'FROM olist_order_payments_dataset\n' +
              'GROUP BY payment_type\n' +
              'ORDER BY payment_count DESC;';
            newSqlTime = '437';
            newNosql = JSON.stringify([
                    {"$group": {
                        "_id": "$payment_type",
                        "count": {"$sum": 1}
                    }},
                    {"$sort": {"count": -1}}
                ]
                );
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q6_chart_image }}';
            break;
          case 'Query 7':
            newText = 'Average completion of processing time/ shipping time';
            newSql = 'SELECT\n' +
              '    AVG(TIMESTAMPDIFF(SECOND, order_purchase_timestamp, order_approved_at))/3600 AS average_processing_time,\n' +
              '    AVG(TIMESTAMPDIFF(SECOND, order_delivered_carrier_date, order_delivered_customer_date))/3600 AS average_shipping_time\n' +
              'FROM\n' +
              '    olist_db.olist_orders_dataset\n' +
              'WHERE\n' +
              '    order_status = \'delivered\';';
            newSqlTime = '100';
            newNosql = JSON.stringify([{
                "$group": {
                  "_id": "$payment_type",
                  "count": {
                    "$sum": 1
                  }
                }
              },
              {
                "$sort": {
                  "count": -1
                }
              }
            ]);
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q7_chart_image }}';
            break;
          case 'Query 8':
            newText = 'Average delivery time and freight fee';
            newSql = 'SELECT\n' +
              'ROUND(AVG(average_delivery_time),2) AS overall_average_delivery_time,\n' +
              'ROUND(AVG(average_delivery_fee),2) AS overall_average_delivery_fee\n' +
              'FROM (\n' +
              'SELECT\n' +
              'OI.order_id,\n' +
              'AVG(TIMESTAMPDIFF(SECOND, O.order_delivered_carrier_date, O.order_delivered_customer_date) / 3600) AS average_delivery_time,\n' +
              'AVG(OI.freight_value) AS average_delivery_fee\n' +
              'FROM olist_order_items_dataset OI\n' +
              'JOIN olist_orders_dataset O ON OI.order_id = O.order_id\n' +
              'WHERE O.order_status = \'delivered\'\n' +
              'GROUP BY OI.order_id\n' +
              ') AS subquery;';
            newSqlTime = '1054.8';
            newNosql = JSON.stringify([{
                "$lookup": {
                  "from": "orders",
                  "localField": "order_id",
                  "foreignField": "order_id",
                  "pipeline": [{
                    "$match": {
                      "order_status": "delivered"
                    }
                  }],
                  "as": "order"
                }
              },
              {
                "$unwind": "$order"
              },
              {
                "$project": {
                  "_id": 0,
                  "order_id": "$order.order_id",
                  "delivery_time_hours": {
                    "$divide": [{
                      "$subtract": [{
                        "$dateFromString": {
                          "dateString": "$order.order_delivered_customer_date"
                        }
                      }, {
                        "$dateFromString": {
                          "dateString": "$order.order_delivered_carrier_date"
                        }
                      }]
                    }, 3600000]
                  },
                  "delivery_fee": "$freight_value"
                }
              },
              {
                "$group": {
                  "_id": "$order_id",
                  "average_delivery_time": {
                    "$avg": "$delivery_time_hours"
                  },
                  "average_delivery_fee": {
                    "$avg": "$delivery_fee"
                  }
                }
              },
              {
                "$group": {
                  "_id": null,
                  "distinct_order_ids": {
                    "$addToSet": "$_id"
                  },
                  "average_delivery_time": {
                    "$avg": "$average_delivery_time"
                  },
                  "average_delivery_fee": {
                    "$avg": "$average_delivery_fee"
                  }
                }
              }
            ]);
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q8_chart_image }}';
            break;
          case 'Query 9':
            newText = 'Average customer reviews score on product category';
            newSql = 'SELECT\n' +
              '    P.product_category_name,\n' +
              '    AVG(R.review_score) AS average\n' +
              'FROM\n' +
              '    olist_db.olist_order_reviews_dataset R\n' +
              '    JOIN olist_db.olist_order_items_dataset I ON R.order_id = I.order_id\n' +
              '    JOIN olist_db.olist_products_dataset P ON I.product_id = P.product_id\n' +
              'GROUP BY\n' +
              '    P.product_category_name\n' +
              'ORDER BY\n' +
              '    average DESC;';
            newSqlTime = '100';
            newNosql = JSON.stringify([{
                '$lookup': {
                  'from': 'order_items',
                  'localField': 'order_id',
                  'foreignField': 'order_id',
                  'as': 'order_items'
                }
              },
              {
                '$unwind': '$order_items'
              },
              {
                '$lookup': {
                  'from': 'products',
                  'localField': 'order_items.product_id',
                  'foreignField': 'product_id',
                  'as': 'product_info'
                }
              },
              {
                '$unwind': '$product_info'
              },
              {
                '$lookup': {
                  'from': 'translated_category',
                  'localField': 'product_info.product_category_name',
                  'foreignField': 'product_category_name',
                  'as': 'category_translation'
                }
              },
              {
                '$unwind': '$category_translation'
              },
              {
                '$group': {
                  '_id': '$category_translation.product_category_name_english',
                  'average_review_score': {
                    '$avg': '$review_score'
                  }
                }
              },
              {
                '$sort': {
                  'average_review_score': -1
                }
              },
              {
                '$project': {
                  'category_name_english': '$_id',
                  'average_review_score': {
                    '$round': ['$average_review_score', 4]
                  },
                  '_id': 0
                }
              }
            ]);
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q9_chart_image }}';
            break;
          case 'Query 10':
            newText = 'Categories with the most sellers';
            newSql = 'SELECT\n' +
              '    P.product_category_name,\n' +
              '    COUNT(DISTINCT S.seller_id)\n' +
              'FROM\n' +
              '    olist_db.olist_products_dataset P\n' +
              '    JOIN olist_db.olist_order_items_dataset I ON P.product_id = I.product_id\n' +
              '    JOIN olist_db.olist_sellers_dataset S ON I.seller_id = S.seller_id\n' +
              'GROUP BY\n' +
              '    P.product_category_name\n' +
              'ORDER BY\n' +
              '    COUNT(DISTINCT S.seller_id) DESC\n' +
              'LIMIT 10;';
            newSqlTime = '100';
            newNosql = JSON.stringify([{
                '$project': {
                  'seller_id': 1,
                  'product_id': 1
                }
              },
              {
                '$lookup': {
                  'from': 'products',
                  'localField': 'product_id',
                  'foreignField': 'product_id',
                  'as': 'product_info'
                }
              },
              {
                '$unwind': '$product_info'
              },
              {
                '$group': {
                  '_id': '$product_info.product_category_name',
                  'unique_sellers': {
                    '$addToSet': '$seller_id'
                  }
                }
              },
              {
                '$project': {
                  'number_of_sellers': {
                    '$size': '$unique_sellers'
                  }
                }
              },
              {
                '$sort': {
                  'number_of_sellers': -1
                }
              }
            ]);
            newNosqlTime = '100';
            finalAnalysis = 'i am alot text';
            dynamicChartImageBase64 = '{{ q10_chart_image }}';
            break;
        }

        $('.dynamic-card-title').text(newText);
        $('.sql-content').text(newSql);
        $('.sql-time').text(
          newSqlTime);
        $('.nosql-content').text(newNosql);
        $('.nosql-time').text(newNosqlTime);
        $('.final-analysis')
          .text(finalAnalysis);

        // Set the dynamic chart image source
        $('#dynamicChartImage').attr('src', 'data:image/png;base64,' + dynamicChartImageBase64);
      });
    });
  </script>
</body>

</html>